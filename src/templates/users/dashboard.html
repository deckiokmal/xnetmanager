{% extends "/layouts/layout.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<!-- Begin Page Content -->

<!-- Page Heading -->
<div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="text-right">Welcome {{ username }}!</h5>
</div>

<!-- Begin dashboard content -->
<div class="container">

    <div class="row">
        <!-- Donut Chart for Templates -->
        <div class="col-12 col-sm-6 col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    Number of Templates
                </div>
                <div class="card-body text-center">
                    <canvas id="templateDonutChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Bar Chart for Devices -->
        <div class="col-12 col-sm-6 col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    Number of Devices
                </div>
                <div class="card-body text-center">
                    <canvas id="deviceBarChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End of dashboard content -->

<!-- End of Page Content -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Chart.js Data and Configuration
    document.addEventListener("DOMContentLoaded", function () {
        const templateDonutCtx = document.getElementById('templateDonutChart').getContext('2d');
        const deviceBarCtx = document.getElementById('deviceBarChart').getContext('2d');

        // Donut Chart for Templates
        new Chart(templateDonutCtx, {
            type: 'doughnut',
            data: {
                labels: ['Templates'],
                datasets: [{
                    label: 'Total Templates',
                    data: [{{ template_count }}], // Pass data from Flask
                backgroundColor: ['#ff6384'],
            }]
        },
            options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    callbacks: {
                        label: function (tooltipItem) {
                            return `Templates: ${tooltipItem.raw}`;
                        }
                    }
                }
            }
        }
        }).canvas.addEventListener('click', function () {
            window.location.href = "/tm";
        });

    // Bar Chart for Devices
    new Chart(deviceBarCtx, {
        type: 'bar',
        data: {
            labels: ['Devices'],
            datasets: [{
                label: 'Total Devices',
                data: [{{ device_count }}], // Pass data from Flask
            backgroundColor: '#36a2eb',
        }]
    },
        options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'top',
            },
            tooltip: {
                callbacks: {
                    label: function (tooltipItem) {
                        return `Devices: ${tooltipItem.raw}`;
                    }
                }
            }
        }
    }
        }).canvas.addEventListener('click', function () {
        window.location.href = "/dm";
    });
    });
</script>
{% endblock %}