Konfigurasi SD-WAN pada FortiGate dengan menggunakan dual HUB melibatkan beberapa langkah dan komponen penting. Berikut adalah informasi yang relevan yang didapat dari konteks yang Anda berikan:

### Tujuan
- Memanfaatkan jaringan IPVPN sebagai koneksi underlay utama SD-WAN.
- Menghubungkan jaringan SPOKE dengan single HUB DC dan HUB DR.
- Sentralisasi semua lalu lintas dari SPOKE menuju HUB DC dan HUB DR.
- Menghubungkan FortiGate HUB ke FortiAnalyzer.
- Mendafarkan semua perangkat FortiGate pada FortiManager.
- Mengamankan koneksi jaringan dari remote ke internet dengan fitur IOC.

### Kebutuhan Awal
- FortiGate type 100F untuk HUB DC dan HUB DR.
- FortiGate 50E atau 40F untuk SPOKE.
- Versi firmware terbaru untuk setiap perangkat FortiGate yang terpasang.
- Lisensi UTM aktif pada FortiGate HUB.

### Implementasi

#### A. Konfigurasi HUB DC
1. Pastikan koneksi underlay SPOKE dapat dijangkau oleh HUB dengan tes PING.
2. Buat VPN Interface (IPSec) pada HUB untuk menerima dialup connection dari SPOKE.
   
   **Phase1 Interface:**
   ```plaintext
   config vpn ipsec phase1-interface
       edit "DC-MAIN"
           set type dynamic
           set interface "wan1"
           set ike-version 2
           set local-gw 172.16.0.1
           set peertype any
           set mode-cfg enable
           set proposal aes256-sha256
           set dpd on-idle
           set dhgrp 14
           set auto-discovery-sender enable
           set network-overlay enable
           set network-id 1
           set ipv4-start-ip 169.251.100.2
           set ipv4-end-ip 169.251.100.253
           set ipv4-netmask 255.255.255.0
           set psksecret S3cr3tKEY-SdWAn!23
       next
       edit "DC-BCKP"
           set type dynamic
           set interface "wan2"
           set ike-version 2
           set local-gw 123.231.0.1
           set peertype any
           set mode-cfg enable
           set proposal aes256-sha256
           set dpd on-idle
           set dhgrp 14
           set auto-discovery-sender enable
           set network-overlay enable
           set network-id 2
           set ipv4-start-ip 169.251.200.2
           set ipv4-end-ip 169.251.200.253
           set ipv4-netmask 255.255.255.0
           set psksecret S3cr3tKEY-SdWAn!23
       next
   end
   ```

   **Phase2 Interface:**
   ```plaintext
   config vpn ipsec phase2-interface
       edit "DC-MAIN"
           set phase1name "DC-MAIN"
           set proposal aes256-sha256
           set dhgrp 14
           set keepalive enable
       next
       edit "DC-BCKP"
           set phase1name "DC-BCKP"
           set proposal aes256-sha256
           set dhgrp 14
           set keepalive enable
       next
   end
   ```

3. Atur interface tunnel agar dapat menerima PING, SSH, dan HTTPS:
   ```plaintext
   config system interface
       edit "DC-MAIN"
           set vdom "root"
           set allowaccess ping ssh https
           set type tunnel
       next
       edit "DC-BCKP"
           set vdom "root"
           set allowaccess ping ssh https
           set type tunnel
       next
       edit "DR-MAIN"
           set vdom "root"
           set allowaccess ping ssh https
           set type tunnel
       next
       edit "DR-BCKP"
           set vdom "root"
           set allowaccess ping ssh https
           set type tunnel
       next
   end
   ```

4. Buat SD-WAN interface untuk melakukan traffic steering:
   ```plaintext
   config system sdwan
       set status enable
       set load-balance-mode source-dest-ip-based
       config zone
           edit "DC"
           next
           edit "DR"
           next
       end
       config members
           edit 1
               set interface "DC-MAIN"
               set zone "DC"
           next
           edit 2
               set interface "DC-BCKP"
               set zone "DC"
           next
           edit 3
               set interface "DR-MAIN"
               set zone "DR"
           next
           edit 4
               set interface "DR-BCKP"
               set zone "DR"
           next
       end
   end
   ```

5. Atur policy untuk dapat melewatkan koneksi VPN dari HUB ke arah LAN SPOKE dan sebaliknya:
   ```plaintext
   config firewall policy
       edit 1
           set name "LAN>DC"
           set srcintf "lan1"
           set dstintf "DC"
           set action accept
           set srcaddr "all"
           set dstaddr "all"
           set schedule "always"
           set service "ALL"
       next
       edit 2
           set name "DC>LAN"
           set srcintf "DC"
           set dstintf "lan1"
           set action accept
           set srcaddr "all"
           set dstaddr "all"
           set schedule "always"
           set service "ALL"
       next
       edit 3
           set name "LAN>DR"
           set srcintf "lan1"
           set dstintf "DR"
           set action accept
           set srcaddr "all"
           set dstaddr "all"
           set schedule "always"
           set service "ALL"
       next
       edit 4
           set name "DR>LAN"
           set srcintf "DR"
           set dstintf "lan1"
           set action accept
           set srcaddr "all"
           set dstaddr "all"
           set schedule "always"
           set service "ALL"
       next
   end
   ```

6. Atur routing BGP untuk menerima koneksi dari arah HUB dan advertise network SPOKE:
   ```plaintext
   config router prefix-list
       edit "LAN-SPOKE"
           config rule
               edit 1
                   set prefix 192.168.10.0/24
               next
           end
       next
   end

   config router community-list
       edit "65500:100"
           config rule
               edit 1
                   set action permit
                   set match "65500:100"
               next
           end
       next
   end

   config router route-map
       edit "IN-FROM-HUB"
           config rule
               edit 1
                   set match-community "65500:100"
                   set set-route-tag 65500100
               next
               edit 2
                   set match-community "65500:1234"
                   set set-route-tag 655001234
               next
           end
       next
       edit "OUT-TO-DC"
           config rule
               edit 1
                   set match-ip-address "LAN-SPOKE"
                   set set-community "65500:111"
               next
           end
       next
       edit "OUT-TO-DR"
           config rule
               edit 1
                   set match-ip-address "LAN-SPOKE"
                   set set-community "65500:111"
                   set set-aspath "65500 65500 65500"
               next
           end
       next
   end
   ```

### Konfigurasi IP Address Tunnel Pada HUB DR
1. Atur IP Address Tunnel pada HUB DR:
   ```plaintext
   config system interface
       edit "DC-MAIN"
           set vdom "root"
           set ip 169.251.101.1 255.255.255.255
           set remote-ip 169.251.101.254 255.255.255.0
           set allowaccess ping ssh https
           set type tunnel
           set interface "wan1"
       next
       edit "DC-BCKP"
           set vdom "root"
           set ip 169.251.200.1 255.255.255.255
           set remote-ip 169.251.201.254 255.255.255.0
           set allowaccess ping ssh https
           set type tunnel
           set interface "wan2"
       next
   end
   ```

2. Atur policy untuk VPN dari SPOKE ke LAN HUB DR dan sebaliknya:
   ```plaintext
   config firewall policy
       edit 1
           set name "HUB-DR > SPOKE"
           set srcintf "lan1"
           set dstintf "DR-MAIN" "DR-BCKP"
           set action accept
           set srcaddr "all"
           set dstaddr "all"
           set schedule "always"
           set service "ALL"
       next
       edit 2
           set name "SPOKE > HUB-DR"
           set srcintf "DR-MAIN" "DR-BCKP"
           set dstintf "lan1"
           set action accept
           set srcaddr "all"
           set dstaddr "all"
           set schedule "always"
           set service "ALL"
       next
       edit 3
           set name "SPOKE > INET"
           set srcintf "DR-MAIN" "DR-BCKP"
           set dstintf "wan2"
           set action accept
           set srcaddr "all"
           set dstaddr "all"
           set schedule "always"
           set service "ALL"
           set utm-status enable
           set ssl-ssh-profile "certificate-inspection"
           set av-profile "default"
           set ips-sensor "protect_client"
           set nat enable
       next
   end
   ```

3. Atur routing BGP untuk menerima koneksi dari arah SPOKE:
   ```plaintext
   config router prefix-list
       edit "LAN-HUB-DR"
           config rule
               edit 1
                   set prefix 192.168.0.0/24
               next
               edit 2
                   set prefix 2.2.2.2/32
               next
           end
       next
   end
   ```

### Kesimpulan
Konfigurasi SD-WAN pada FortiGate dengan dual HUB membutuhkan pengaturan yang teliti pada berbagai aspek, termasuk konfigurasi VPN IPSec, interface tunnel, SD-WAN interface, policy firewall, dan routing BGP. Semua langkah di atas memastikan bahwa jaringan SPOKE dapat terhubung dengan lancar dan aman ke HUB DC dan HUB DR, serta dapat mengamankan koneksi remote ke internet.